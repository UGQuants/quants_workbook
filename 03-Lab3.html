<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>lab3 – Lab Workbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-Lab4.html" rel="next">
<link href="./02-Lab2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-6561bbde787c299e21493071c8edc6ff.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-1efbf008e2baeeb4cb205a51dd9b7791.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="style.css">
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./brand/uofg-keyline.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Lab Workbook</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./assessments/assessments.html"> 
<span class="menu-text">Assessments</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/UGQuants/quants_workbook" title="Workbook GitHub" class="quarto-navigation-tool px-1" aria-label="Workbook GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"></h1>
        </a>     
    </div>
  </nav><div id="quarto-announcement" data-announcement-id="2d92ee72f5f7cb3880c08507c300d9e0" class="alert alert-info hidden">
<i class="bi bi-info-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p><strong>Reminder</strong> - check your email for your Posit Cloud group join link, links are also available in the lab group forums on Moodle.</p>
</div>
<i class="bi bi-x-lg quarto-announcement-action"></i>
</div>
</header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 1</strong> Introduction to R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Lab2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 2</strong> Data in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-Lab3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><strong>Lab 3</strong> Data Wrangling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Lab4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 4</strong> Exploratory Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Lab5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 5</strong> Reporting in R Markdown</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Lab6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 6</strong> Visual Exploratory Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Lab7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 7</strong> Correlation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Lab8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 8</strong> Simple Linear Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-Lab9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 9</strong> Multiple Linear Regression (part 1)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Lab10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 10</strong> Multiple Linear Regression (part 2)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-Lab11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Lab 11</strong> Interpretive Report Assessment</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Answers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workbook suggested answers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./References.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#data-wrangling" id="toc-data-wrangling" class="nav-link active" data-scroll-target="#data-wrangling">Data wrangling</a>
  <ul class="collapse">
<li>
<a href="#the-nilt-documentation" id="toc-the-nilt-documentation" class="nav-link" data-scroll-target="#the-nilt-documentation">The NILT Documentation</a>
  <ul class="collapse">
<li><a href="#variable-names-and-labels" id="toc-variable-names-and-labels" class="nav-link" data-scroll-target="#variable-names-and-labels">Variable Names and Labels</a></li>
  <li><a href="#values-and-measures" id="toc-values-and-measures" class="nav-link" data-scroll-target="#values-and-measures">Values and Measures</a></li>
  </ul>
</li>
  <li><a href="#nilt-rstudio-project" id="toc-nilt-rstudio-project" class="nav-link" data-scroll-target="#nilt-rstudio-project">NILT RStudio Project</a></li>
  <li>
<a href="#creating-an-r-script" id="toc-creating-an-r-script" class="nav-link" data-scroll-target="#creating-an-r-script">Creating an R Script</a>
  <ul class="collapse">
<li><a href="#opening-and-installing-packages" id="toc-opening-and-installing-packages" class="nav-link" data-scroll-target="#opening-and-installing-packages">Opening and Installing Packages</a></li>
  <li><a href="#downloading-the-nilt" id="toc-downloading-the-nilt" class="nav-link" data-scroll-target="#downloading-the-nilt">Downloading the NILT</a></li>
  </ul>
</li>
  <li><a href="#data-wrangling-1" id="toc-data-wrangling-1" class="nav-link" data-scroll-target="#data-wrangling-1">Data wrangling</a></li>
  <li>
<a href="#read-the-clean-dataset" id="toc-read-the-clean-dataset" class="nav-link" data-scroll-target="#read-the-clean-dataset">Read the clean dataset</a>
  <ul class="collapse">
<li><a href="#activity" id="toc-activity" class="nav-link" data-scroll-target="#activity">Activity</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/UGQuants/quants_workbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><section id="data-wrangling" class="level1"><h1>Data wrangling</h1>
<p>Welcome to Lab 3!</p>
<p>In our previous session we learned about <code>R</code> packages, including how to install and load them. We talked about the main types of data used in social science research and how to represent them in <code>R</code>. We also played around with some datasets using some key functions, such as: <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. In this session, we will build of these principles and learn how to import data in <code>R</code>, clean and format the data using a real-world dataset. This is a common and important phase in quantitative research.</p>
<div class="callout callout-style-simple callout-note callout-titled" title="Overview">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Overview
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this lab you will know how to:</p>
<ul>
<li>set up an RStudio project file from scratch</li>
<li>create an R script to download, wrangle, and save a dataset</li>
<li>load a saved dataset within an R Markdown file</li>
<li>work with the dataset used in the formative and summative assessments</li>
</ul>
</div>
</div>
<section id="the-nilt-documentation" class="level2"><h2 class="anchored" data-anchor-id="the-nilt-documentation">The NILT Documentation</h2>
<p>Today, we will be working with data generated by the <a href="https://www.ark.ac.uk/ARK/">Access Research Knowledge (ARK)</a> hub. ARK conducts a series of surveys about society and life in Northern Ireland. For this lab, we will be working with the results of the <a href="https://www.ark.ac.uk/nilt/">Northern Ireland Life and Times Survey (NILT)</a> in the year 2012. In particular, we will be using a teaching dataset that focuses on community relations and political attitudes. This includes background information of the participants and their household.</p>
<p>Please take 5-10 minutes to read the <a href="https://www.ark.ac.uk/teaching/NILT2012TeachingResources.pdf">documentation</a> for the dataset. Such documentation is always important to read as it will usually cover the research design, sampling, and information on the variables. For instance, page 7 onwards has the codebook with columns listing variable name, variable label, values, and measure. (Page 6 of the documentation provides a “Navigating the codebook (example section)” overview for how to understand the table.)</p>
<p>It is also worthwhile taking a look through the <a href="https://www.ark.ac.uk/nilt/2012/quest12.html">questionnaires</a> for the survey as well. You will have to regularly consult the technical document and questionnaires to understand and use the data in the NILT data set. So, I recommend you to bookmark the links / save copies of the PDF files.</p>
<p>This NILT teaching dataset is also what you will be using for the research report assignment in this course (smart, isn’t it?) - so it’s worth investing the time to learn how to work with this data through the next few labs, as part of the preparation and practice for your assignment.</p>
<section id="variable-names-and-labels" class="level3"><h3 class="anchored" data-anchor-id="variable-names-and-labels">Variable Names and Labels</h3>
<p>Let’s first go through the codebook in more detail. This will help you understand how to read the information in it, and some common ‘gotchas’ to look out for.</p>
<p>The “Variable Name” is how the variables are named in the data set - except in all caps, whereas once we start working with the data they will be lowercase. If we read the data set into a data frame named <code>nilt</code>, the <code>rage</code> variable name would be accessed as <code>nilt$rage</code>. For consistency with how they will appear when working with them in R, I am going to stick to using all lower case.</p>
<p>The “Label” column mostly shows the corresponding text used in the survey for the variable. For <code>rage</code> it is “Q1. Household grid: Age of respondent”. If you look at page 2 of the <a href="https://www.ark.ac.uk/nilt/2012/main12.pdf">main questionnaire</a>, you will see that the ‘household grid’ was a repeat set of questions used to gather key information about each member of the household. The <code>r</code> in <code>rage</code> stands for “respondent”, i.e.&nbsp;the person who answered the survey questions.</p>
<p>Some variable names, such as <code>work</code> and <code>tunionsa</code> on page 9, note under the name “(compute)”. This means the variable rather than representing a direct answer to a survey question is instead ‘computed’ / ‘derived’ from answers to other questions. The variable label for these then detail which questions were used to compute these variables. Work status may seem an odd variable to compute rather than ask directly. However, as can see from page 39 in the <a href="https://www.ark.ac.uk/nilt/2012/main12.pdf">main questionnaire</a>, a series of questions were asked to ascertain employment status and economic activity. Given the diversity of situations people can be in, it is more practical to ask a series of yes/no and other questions and then use these to calculate categories for other variables.</p>
<p>Whilst it may look more complex on paper, it is simpler for respondents. Let’s imagine being a 32 year old respondent who answers ‘No’ to Q8, whether taken part in paid work in last seven days, and then ‘Yes’ to Q9a, whether taking part in a government scheme for employment training.</p>
<p><img src="./images/lab3_q8.png" class="img-fluid" alt="Questions 8 and 9a from the survey">/</p>
<p>From these two answers we can compute the respondent is ‘Government training scheme’ for <code>empst</code>, ‘Not in paid employment’ for <code>empst2</code>, and ‘Economically active’ for <code>econact</code>. Note as well that Q9a was only asked based on whether the participant would be eligible for the government training scheme, calculated using age and gender. (Highlighted in blue above.)</p>
<p><img src="./images/lab3_q8-2.png" class="img-fluid" alt="Calculated values for our imagined respondent">/</p>
<p>Importantly, we gathered this information by asking simple yes/no questions, structured the questions in way to only ask the minimum number of questions relevant for the respondent, and avoided needing to explain jargon such as ‘economically active’. Economically active means someone is either in employment (including waiting to start a job they have been offered and accepted) or unemployed but looking for work and if offered could start a job within the next two weeks. The questions capture this complexity - and more - and without ever having to provide a definition of economically active.</p>
<p>The <code>tunionsa</code> variable is also a good example of why cannot assume what a variable measures by its name. As can see bottom of page 9 in the <a href="https://www.ark.ac.uk/teaching/NILT2012TeachingResources.pdf">documentation</a>, <code>tunionsa</code> is derived from Q22 and Q22a.</p>
<p><img src="./images/lab3_tu.png" class="img-fluid" alt="Codebook showing tunionsa derived from Q22-Q22a.">/</p>
<p>However, if we look at those two questions on page 43 of the questionniare - screenshot below to save having to switch tabs - we can see Q22 asks the respondent whether they are currently a member of a trade union or staff association and Q22a is whether they have ever been a member.</p>
<p><img src="./images/lab3_tu2.png" class="img-fluid" alt="Questions Q22 and Q22a in the main questionnaire.">/</p>
<p>If a respondent answered ‘Yes, trade union’ or ‘Yes, staff association’ for <strong>either</strong> Q22 or Q22a the value computed for <code>tunionsa</code> is ‘Yes’. Whilst <code>tunionsa</code> then is broadly a measure of trade union membership it would be more accurate to say it is a measure of whether the respondent currently is <strong>or</strong> ever was a member of a trade union or staff association.</p>
<p>Do not worry if you could not tell that from just the codebook. Normally, dataset documentation should also include a separate section with information on how each computed variable was derived. I was only able to confirm this was how <code>tunionsa</code> was computed by checking the values with those for Q22 and Q22a in the main data set. This though does show the importance of not assuming what a variable measures by just its name and label. If we mistook <code>tunionsa</code> as measuring current membership only, we may then later be surprised seeing the high number of people currently unemployed with ‘Yes’ for <code>tunionsa</code>. It is not surprising to see that though when we understand that ‘Yes’ includes those who have ever been a member.</p>
</section><section id="values-and-measures" class="level3"><h3 class="anchored" data-anchor-id="values-and-measures">Values and Measures</h3>
<p>The ‘Measure’ column in the codebook tells us whether the variable is ‘scale’, ‘nominal’, or ‘ordinal’. This is based on how SPSS, a proprietary statistical analysis program that was used by the NILT project, stores variables. Within R, these correspond respectively with numeric, (unordered) factor, and ordered factor variables that we covered last week. As we will also cover later in the lab, the tidyverse also provides us with tools to work with data created in SPSS.</p>
<p>The ‘Values’ column then tells us what the numbers represent. For numeric variables this is the unit being measured, such as “years” and “number of people”. This may seem ‘obvious’ for some variables, but good documentation should still always provide this information. The importance of this becomes clearer if we look at <code>livearea</code>. Without it clarifying “Numeric (years)” someone could mistake it as representing number of months instead. Similarly, the “0 Less than 1 year” is an important clarifier, helping us understand that anything less than 1 year was recorded as 0. In other words, if someone had lived in the area for 7 months, it was still recorded as 0 rather than rounded up to 1.</p>
<p><img src="./images/lab3_livearea.png" class="img-fluid" alt="livearea with values highlighted in yellow"><br></p>
<p>For the categorical variables it then provides the code and label for the categories. For example, with <code>rsex</code> the categories are 1 (code) Male (label) and 2 (code) Female (label). As mentioned last week, the ‘raw’ data is often stored in numeric codes as - among other reasons - it is more efficient to store it this way. Using the codebook, someone looking at the raw data would then know that a value of 1 represents Male. And as we will cover later, knowing the code and label means we can set up the data in R to show the labels instead of the raw codes.</p>
<p><img src="./images/lab3_rsex.png" class="img-fluid" alt="rsex with the category codes and labels highlighted in yellow"><br></p>
<p>You may have spotted though that the Values column for some variables also includes additional grey text, “-9 Non Applicable”, “-99 Don’t Know”, and “-999 Not answered/refused”. These are part of what is known as ‘missing values’, where we do not have an answer to a question for a participant, where these values record the reason why an answer is missing. Recording such reasons is important for multiple reasons. Let’s take ‘-9 Non Applicable’, which following convention is used in the NILT to denote the reason there is no answer is the participant was not asked the question. For example, as shown in image below if a person answered ‘Yes’ to question 8 to say they were in paid work, then they were not asked question 9a.</p>
<p><img src="./images/lab3_q8-3.png" class="img-fluid" alt="Conditional logic where Q9a skipped if answered ‘Yes’ to Q8">/</p>
<p>For clarity, we record it as ‘non applicable’ instead of leaving it blank or ‘No’. If we left it blank we would not know whether it was blank because the question was skipped deliberately or accidentally. If we recorded it as ‘No’ rather than ‘non applicable’, we lose distinction between our participants. For instance, say we had 100 respondents and 10 answered yes, 20 answered no, and 70 were non applicable. We know from those values that of the 30 who could potentially be on a government scheme 20 were not.</p>
<p>“-99 Don’t Know” and “-999 Not answered/refused” are then useful to know whilst the question was applicable to the respondent, it was not answered for another reason. During a pilot of the survey, a higher than expected number of “Don’t know” and “Not answered” can also help indicate where a question is potentially unclear or phrased in a way that respondents do not feel comfortable answering.</p>
<p>Importantly though as ‘missing values’ they are treated the same in analysis. Within R, values designated as ‘missing values’ are grouped together and labelled “NA”. Take note, this stands for “Not available” - covering all reasons a value is not available (i.e.&nbsp;missing). A common mistake people make is to assume NA stands for ‘non applicable’, resulting in inaccurate interpretations.</p>
<p>As with all conventions though, there are situations where it can be useful to not treat certain values as ‘missing’. Whilst the NILT treats “Don’t know” as a missing value, some surveys will have questions where “Don’t know” is meaningful answer for the analysis. For example, a question like “Who is the current UK Prime Minister?” as part of research on public understanding of politics, a “Don’t know” is a meaningful answer rather than a missing value. In such cases, the “Don’t know” would not have a “-99” or equivalent code.</p>
<p>In some cases it can also be worthwhile exploring whether there is any pattern behind missing values. It may turn out that certain groups were more likely to refuse to answer or response “Don’t know” to specific questions. This can then open discussion as to why and what changes to the survey design may help address it. Again that we record the reason the value is ‘missing’ rather than leaving the value blank makes it possible to still do that.</p>
</section></section><section id="nilt-rstudio-project" class="level2"><h2 class="anchored" data-anchor-id="nilt-rstudio-project">NILT RStudio Project</h2>
<p>We will continue using Posit Cloud, as we did in the previous labs. This time though we are going to make a new RStudio project from scratch.</p>
<p>Within your “Lab Group …” workspace in <a href="https://posit.cloud">Posit Cloud</a> (if you have not joined a shared space, follow the instructions in <a href="./02-Lab2.html#activity">Lab 2</a>) and:</p>
<ol type="1">
<li>Click the blue ‘New Project’ button in the top-right.</li>
<li>From the list of options select ‘New RStudio Project’.</li>
</ol>
<p><img src="./images/lab3_new-project.png" class="img-fluid" alt="New Project > New RStudio Project"><br></p>
<p>Once the project has loaded, click on ‘Untitled Project’ at the top of the screen.</p>
<p><img src="./images/lab3_untitled.png" class="img-fluid" alt="Click on ‘Untitled Project’ to give your project a name"><br></p>
<p>You can now give your project a name. This is how it will appear in your list of projects in your lab group workspace. Let’s name it “NILT” as we will use this project to work with the NILT data. Type the name and hit <code>Enter</code> to confirm.</p>
<p><img src="./images/lab3_nilt-title.png" class="img-fluid" alt="Click on ‘Untitled Project’ to give your project a name"><br></p>
</section><section id="creating-an-r-script" class="level2"><h2 class="anchored" data-anchor-id="creating-an-r-script">Creating an R Script</h2>
<p>We are going to set up this project in a ‘reproducible’ way. This means anyone with a copy of our project would be able to run the code and receive the same results as us. Last week, we downloaded a data set using the Console. This week we will instead cover one way to include the code used to download and wrangle our data in a file separate to the R Markdown file use for the analysis.</p>
<p>To do this we will use an R script file. In our first two labs we used R Markdown, which lets us create code chunks for adding our R code. An R script file is simply a file that contains only R code, like a giant code chunk.</p>
<p>By convention, R scripts for doing set up, data prep, and similar are placed in an ‘R’ subfolder. To create one:</p>
<ol type="1">
<li>In the “Files” pane (bottom-right) click the folder icon that also has a green circle with white plus in it.</li>
</ol>
<p><img src="./images/lab3_new-folder.png" class="img-fluid" alt="The icon to click to create a new folder"><br></p>
<p>Then, within the ‘New Folder’ dialog that will pop up:</p>
<ol start="2" type="1">
<li>Type a single letter capital ‘R’ as the name.</li>
<li>Click the ‘OK’ button to confirm creation of the folder.</li>
</ol>
<p><img src="./images/lab3_new-folder2.png" class="img-fluid" alt="‘New Folder’ dialog"><br></p>
<p>You should now see the new folder in the bottom-right panel, so -</p>
<ol start="4" type="1">
<li>Click the ‘R’ folder to navigate into it (Note, you need to click the ‘R’ and not the folder icon.)</li>
</ol>
<p><img src="./images/lab3_new-folder3.png" class="img-fluid" alt="Navigate to the ‘R’ sub-folder"><br></p>
<p>You should now see an empty folder, and can double check you are in the right folder by looking at the navigation bar which should be “Cloud &gt; project &gt; R”.</p>
<p><img src="./images/lab3_new-folder4.png" class="img-fluid" alt="Check you are in the right place"><br></p>
<p>OK, now:</p>
<ol start="5" type="1">
<li>Click the white document icon that is to the right of the new folder icon you clicked before. (See screenshot below!)</li>
<li>From the list of options click ‘R Script’</li>
</ol>
<p><img src="./images/lab3_new-folder5.png" class="img-fluid" alt="Create a new R Script"><br></p>
<p>That will bring up a ‘Create a New File in Current Directory’ dialog:</p>
<ol start="7" type="1">
<li>Name your file <code>01_prep_nilt_2012.R</code>
</li>
<li>Click the ‘OK’ button to confirm creation of the script</li>
</ol>
<p><img src="./images/lab3_new-folder6.png" class="img-fluid" alt="Create a New File in Current Directory dialog"><br></p>
<p>The file should then auto open in the top-left pane.</p>
<p><img src="./images/lab3_new-folder7.png" class="img-fluid" alt="Create a New File in Current Directory dialog"><br></p>
<p>Lastly, before we move to writing our R script, let’s navigate back to the top-level folder of our project in the ‘Files’ pane (bottom-right). To navigate back up to the top-level folder, click <em>either</em> the ‘..’ at the top of the folder content list or in the navigation bar click the ‘project’ text</p>
<p><img src="./images/lab3_new-folder8.png" class="img-fluid" alt="Navigate back to parent folder"><br></p>
<section id="opening-and-installing-packages" class="level3"><h3 class="anchored" data-anchor-id="opening-and-installing-packages">Opening and Installing Packages</h3>
<p>Back to our top-left pane with our R script. It is good practice to include some key information in this file, such as what it does, when it was written, and who wrote it. Given R script is all R code, we can add this info using comments. As a reminder, any line in R that begins with a ‘#’ is treated as a comment and will not be run as part of the code.</p>
<p>Below is template you can use.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Download and process NILT 2012 survey</span></span>
<span></span>
<span><span class="co"># Date: [add today's date here]</span></span>
<span><span class="co"># Author: [add your name here]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The ‘##’, with an extra ‘#’, at the top doesn’t do anything extra or different, we just include it to make visually clear this is the title / short description of what the script does.</p>
<p>Next, it is good practice to include details for the data set being used, especially important if the data is not our own to ensure proper attribution.</p>
<p>Let’s then added a reference section. (Feel free to use the clipboard button in top-right of the box below to copy and paste the text.)</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># References  -----------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># https://www.ark.ac.uk/teaching/</span></span>
<span><span class="co"># 2012 Good relations: ARK. Northern Ireland Life and Times Survey Teaching Dataset 2012, Good relations [computer file]. ARK www.ark.ac.uk/nilt [distributor], March 2014.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>-----</code> after <code># References</code> again doesn’t do anything aside from help make the section visually distinct. This may seem odd at the moment, but as the file grows in length, the importance of making it easy to find sections quickly from visual glance starts to make sense.</p>
<p>OK, let’s now install packages that are needed for our project. Wait - didn’t we say last week that we install packages in the Console as it is something we only do once? Yes, and we can keep it that way in the R code we will use for the script. Importantly, our script includes code to install any needed packages <em>and</em> remains separate from the R Markdown files we will create in later weeks for our analysis.</p>
<p>First, add a comment to make clear there is a new section:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Packages -------------------------------------------------------------------</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, add the following comment and code:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Install tidyverse if needed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"tidyverse"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code may look complex, but it is largely the number of brackets making it looks more complex than it actually is:</p>
<ul>
<li>
<code>if</code> checks whether a given object is TRUE or FALSE, and is used in format <code>if x y</code>, where if <code>x</code> returns TRUE then <code>y</code> code is run.</li>
<li>
<code>(...)</code> we use to enclose a chunk of code to make clear this is our <code>x</code>.</li>
<li>
<code>!"tidyverse" %in%</code> uses the <code>!</code> logical operator and <code>%in%</code> operator, which is equivalent then of saying “If the word ‘tidyverse’ is <strong>not</strong> in…”</li>
<li>
<code><a href="https://rdrr.io/r/base/colnames.html">rownames()</a></code> gets the label names for rows in a data frame or matrix (matrix is like a simplier data frame)</li>
<li>
<code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> is a function that returns a matrix with all packages currently installed on the system, so within Posit Cloud is all the the installed packages within the current project. Each row’s label name matches the installed package name.</li>
<li>
<code>install.packages("tidyverse")</code> you know already and installs the tidyverse</li>
</ul>
<p>Putting it all today, we have <code>if</code> the tidyverse is not in our currenly installed packages then install the tidyverse. That way we - and anyone we share the project with - avoid installing and re-installing the tidyverse needlessly each time the script is run.</p>
<p>We can test it by putting your text cursor on the line with the code and pressing <code>Ctrl+Enter</code>, or click the Run button at the top of your file.</p>
<p><img src="./images/lab3_iftidy.png" class="img-fluid" alt="Run button, ensure your text cursor is on line with the code to run (highlighted yellow)"><br></p>
<p>You should see the tidyverse installing in the Console. Once it has finished installing, trying running the same line of code again.</p>
<p><img src="./images/lab3_already-tidy.png" class="img-fluid" alt="Run button, ensure your text cursor is on line with the code to run (highlighted yellow)"><br></p>
<p>As can see, the code will be sent to the Console but the tidyverse is not installed again. As the <code>if</code> not returns <code>FALSE</code> as tidyverse is in the names of our installed packages, then the code to install it is no longer run.</p>
<p>Now, we need to load the packages we will be using. As you can probably guess the tidyverse is one, and we will be adding a new one as well ‘haven’. Add the following lines to your script.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>TODO</p>
</section><section id="downloading-the-nilt" class="level3"><h3 class="anchored" data-anchor-id="downloading-the-nilt">Downloading the NILT</h3>
<p>TO-UPDATE</p>
<p>Next, we will create a folder to store the data. Then, download and read the NILT data set, following the next steps:</p>
<ol type="1">
<li>From your script, create a new folder called ‘data’:</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Download the data using the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function. Remember that you have to specify the URL first, and the destination of the file second (including the folder).</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ark.ac.uk/teaching/NILT2012GR.sav"</span>,</span>
<span>  <span class="st">"data/nilt2012.sav"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Take a look to the ‘Files’ tab in pane 3, you will see a folder called ‘data’, click on it, and you will see the <code>nilt2012.sav</code> file.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/rstudio_cloud_files.png" class="img-fluid figure-img"></p>
<figcaption>Cloud files.</figcaption></figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>To read this type of file use the <code><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav()</a></code> function. Read the <code>.sav</code> file and assign it to an object called <code>nilt</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nilt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav</a></span><span class="op">(</span><span class="st">"data/nilt2012.sav"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And that’s it! You should see a new data object in your ‘Environment’ tab (Pane 2) ready to be used. You can also see that this contains 1204 observations (rows) and 133 variables (columns). Lets glimpse our newly imported data and see the type of variables included.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">nilt</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="data-wrangling-1" class="level2"><h2 class="anchored" data-anchor-id="data-wrangling-1">Data wrangling</h2>
<p>As you can see from the result of glimpse, the class for practically all the variables is <code>&lt;dbl+lbl&gt;</code>. What does this mean? This happened because usually datasets use numbers to represent each of the categories/levels in categorical variables. These numbers are <em>labelled</em> with their respective meaning. This is why we have a combination of value types (<code>&lt;dbl+lbl&gt;</code>). Take the example of the variable called <code>rsex</code>, as you can see from the values displayed using <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code>, this includes numbers only, e.g.&nbsp;<code>1,1,2,2...</code>. This is because ‘1’ represents ‘Male’ respondents and ‘2’ represents ‘Female’ respondents in the NILT dataset (n.b.&nbsp;the authors of this lab workbook recognise that sex and gender are different concepts, and we acknowledge this tension and that it will be problematic to imply or define gender identities as binary, as with any dataset. More recent surveys normally approach this in a more inclusive way by offering self-describe options). You can check the pre-defined parameters of the variable in NILT in the <a href="https://www.ark.ac.uk/teaching/NILT2012TeachingResources.pdf">documentation</a> or running <code>print_labels(nilt$rsex)</code> in your console, which returns the numeric value and its respective label. As with <code>rsex</code>, this is the case for many other variables in this data set.</p>
<p>You should be aware that this type of ‘mix’ variable is a special case since we imported a file from a <em>foreign</em> file that saves metadata for each variable (containing the names of the categories). As you learned in the last lab, in <code>R</code> we treat categorical variables as <code>factor</code>. Therefore, we will coerce some variables as <code>factor</code>. This time we will use the function <code><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor()</a></code> instead of the simple <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> that we used before. This is because <code><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor()</a></code> allows us to keep the names of each category in the variables. The syntax is exactly the same as before. Copy and run the following from your script:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Gender of the respondent</span></span>
<span><span class="va">nilt</span> <span class="op">&lt;-</span> <span class="va">nilt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rsex <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">rsex</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Highest Educational qualification</span></span>
<span><span class="va">nilt</span> <span class="op">&lt;-</span> <span class="va">nilt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>highqual <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">highqual</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Religion</span></span>
<span><span class="va">nilt</span> <span class="op">&lt;-</span> <span class="va">nilt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>religcat <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">religcat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Political identification</span></span>
<span><span class="va">nilt</span> <span class="op">&lt;-</span> <span class="va">nilt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>uninatid <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">uninatid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Happiness</span></span>
<span><span class="va">nilt</span> <span class="op">&lt;-</span> <span class="va">nilt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ruhappy <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">ruhappy</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice from the code above that we are replacing the ‘old’ dataset with the result of the mutated variables that are of type <code>factor</code>. This is why we assigned the result with the <em>assigning operator</em> <code>&lt;-</code>.</p>
<p>What about the numeric variables? In the documentation file there is a table in which you will see a type of measure ‘scale’. This usually refers to continuous numeric variables (e.g.&nbsp;age or income).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Let’s coerce some variables to the appropriate type.</p>
<p>In the previous operation we coerced the variables as factor one by one, but we can transform several variables at once within the <code>mutate</code> function. As we did before, copy and run the following code in your script:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Coerce several variables as numeric</span></span>
<span><span class="va">nilt</span> <span class="op">&lt;-</span> <span class="va">nilt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    rage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">rage</span><span class="op">)</span>,</span>
<span>    rhourswk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">rhourswk</span><span class="op">)</span>,</span>
<span>    persinc2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">persinc2</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before doing some analyses, we will drop unused levels (or categories) in our dataset using the function <code><a href="https://rdrr.io/r/base/droplevels.html">droplevels()</a></code>, as following:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># drop unused levels</span></span>
<span><span class="va">nilt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">nilt</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The previous function is useful to remove some categories that are not being used in the dataset (e.g.&nbsp;categories including 0 observations).</p>
<p>Finally, save the NILT survey in an <code>.rds</code> file (this is the R format). We will not use this file now, but this will save us time formatting the dataset in next labs (So, we do not have to repeat the steps above every time).</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">nilt</span>, <span class="st">"data/nilt_r_object.rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="read-the-clean-dataset" class="level2"><h2 class="anchored" data-anchor-id="read-the-clean-dataset">Read the clean dataset</h2>
<p>Phew! Good job. You have completed the basics for wrangling the data and producing a workable dataset.</p>
<p>As a final step, just double check that things went as expected. For this purpose, we will re-read the clean dataset.</p>
<section id="activity" class="level3"><h3 class="anchored" data-anchor-id="activity">Activity</h3>
<ul>
<li>Using the <code><a href="https://rdrr.io/r/base/readRDS.html">readRDS()</a></code> function, read the <code>.rds</code> file that you just created in the last step and assign it to an object called <code>cleaned_data</code>. Remember to include the full directory of the file using quotation marks inside the function.</li>
<li>Run the <code>glimpse</code> function on the <code>cleaned_data</code> object.</li>
<li>Run the <code>glimpse</code> function on the <code>nilt</code> object.</li>
<li>Do they look the same? If yes, it means that you successfully saved your work.</li>
</ul>
<p>Add activity to create project for following along with Fogarty book!</p>


</section></section></section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>Be careful, in some cases these actually correspond to <em>discrete</em> numeric values in this dataset (things that can be counted, e.g.&nbsp;number of…).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ugquants\.github\.io\/quants_workbook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-Lab2.html" class="pagination-link" aria-label="**Lab 2** Data in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><strong>Lab 2</strong> Data in R</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-Lab4.html" class="pagination-link" aria-label="**Lab 4** Exploratory Data Analysis">
        <span class="nav-page-text"><strong>Lab 4</strong> Exploratory Data Analysis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/UGQuants/quants_workbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Licensed under <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <i class="fa-brands fa-creative-commons-sa" aria-label="creative-commons-sa"></i> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons BY-NC-SA 4.0</a></p>
</div>
  </div>
</footer>


</body></html>